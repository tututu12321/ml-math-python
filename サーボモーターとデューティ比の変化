import numpy as np
import matplotlib.pyplot as plt

# ğŸ”¹ ã‚µãƒ¼ãƒœãƒ¢ãƒ¼ã‚¿ãƒ¼ã®ç‰¹æ€§
PWM_FREQUENCY = 50  # PWMä¿¡å·ã®å‘¨æ³¢æ•°ï¼ˆHzï¼‰
MIN_PULSE_WIDTH = 1.0  # æœ€å°ãƒ‘ãƒ«ã‚¹å¹…ï¼ˆmsï¼‰
MAX_PULSE_WIDTH = 2.0  # æœ€å¤§ãƒ‘ãƒ«ã‚¹å¹…ï¼ˆmsï¼‰
ANGLE_RANGE = 180  # ã‚µãƒ¼ãƒœã®å›è»¢ç¯„å›²ï¼ˆåº¦ï¼‰

# ğŸ”¹ PWMä¿¡å·ã‹ã‚‰è§’åº¦ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°
def pwm_to_angle(duty_cycle):
    """
    PWMã®ãƒ‡ãƒ¥ãƒ¼ãƒ†ã‚£æ¯”(%) ã‹ã‚‰ ã‚µãƒ¼ãƒœãƒ¢ãƒ¼ã‚¿ãƒ¼ã®è§’åº¦ (åº¦) ã‚’è¨ˆç®—
    """
    pulse_width = (duty_cycle / 100) * (1000 / PWM_FREQUENCY)  # ãƒ‘ãƒ«ã‚¹å¹…ï¼ˆmsï¼‰
    angle = np.clip(((pulse_width - MIN_PULSE_WIDTH) / (MAX_PULSE_WIDTH - MIN_PULSE_WIDTH)) * ANGLE_RANGE, 0, ANGLE_RANGE)
    return angle

# ğŸ”¹ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®æ™‚é–“è¨­å®š
time = np.linspace(0, 2, 500)  # 2ç§’é–“ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ500ã‚¹ãƒ†ãƒƒãƒ—ï¼‰

# ğŸ”¹ ãƒ‡ãƒ¥ãƒ¼ãƒ†ã‚£æ¯”ã®å¤‰åŒ–ï¼ˆ10% ã‹ã‚‰ 20% ã¸ç·šå½¢å¢—åŠ ï¼‰
duty_cycle = np.linspace(5, 10, len(time))  # ä¾‹: ãƒ‡ãƒ¥ãƒ¼ãƒ†ã‚£æ¯” 5% ã‹ã‚‰ 10% ã¸å¤‰åŒ–

# ğŸ”¹ å„æ™‚åˆ»ã®è§’åº¦ã‚’è¨ˆç®—
angles = pwm_to_angle(duty_cycle)

# ğŸ”¹ çµæœã®ãƒ—ãƒ­ãƒƒãƒˆ
plt.figure(figsize=(10, 5))

# PWMä¿¡å·ï¼ˆãƒ‡ãƒ¥ãƒ¼ãƒ†ã‚£æ¯”ï¼‰ã®ãƒ—ãƒ­ãƒƒãƒˆ
plt.subplot(2, 1, 1)
plt.plot(time, duty_cycle, label="PWM Duty Cycle (%)", color='b')
plt.xlabel("Time (s)")
plt.ylabel("Duty Cycle (%)")
plt.title("PWM Duty Cycle Over Time")
plt.grid()
plt.legend()

#  ã‚µãƒ¼ãƒœãƒ¢ãƒ¼ã‚¿ãƒ¼ã®è§’åº¦å¤‰åŒ–ã®ãƒ—ãƒ­ãƒƒãƒˆ
plt.subplot(2, 1, 2)
plt.plot(time, angles, label="Servo Angle (Â°)", color='r')
plt.xlabel("Time (s)")
plt.ylabel("Servo Angle (Â°)")
plt.title("Servo Motor Angle Over Time")
plt.grid()
plt.legend()

plt.tight_layout()
plt.show()
