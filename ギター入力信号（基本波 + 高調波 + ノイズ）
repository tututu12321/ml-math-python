import numpy as np
import matplotlib.pyplot as plt
from scipy.signal import butter, filtfilt

# ğŸ”¹ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š
fs = 44100  # ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãƒ¬ãƒ¼ãƒˆï¼ˆHzï¼‰
T = 0.02  # ä¿¡å·ã®é•·ã•ï¼ˆç§’ï¼‰
t = np.linspace(0, T, int(fs * T), endpoint=False)  # æ™‚é–“è»¸

# ğŸ”¹ ã‚®ã‚¿ãƒ¼å…¥åŠ›ä¿¡å·ï¼ˆåŸºæœ¬æ³¢ + é«˜èª¿æ³¢ + ãƒã‚¤ã‚ºï¼‰
freq = 440  # A4ï¼ˆãƒ©ï¼‰ã®éŸ³ï¼ˆHzï¼‰
input_signal = np.sin(2 * np.pi * freq * t) + 0.2 * np.sin(2 * np.pi * 2 * freq * t)  # åŸºæœ¬æ³¢ + ç¬¬2é«˜èª¿æ³¢
input_signal += 0.05 * np.random.randn(len(t))  # ãƒã‚¤ã‚ºè¿½åŠ 

# ğŸ”¹ ã‚¨ãƒ¬ã‚­ã‚®ã‚¿ãƒ¼ã‚¢ãƒ³ãƒ—ã®å¢—å¹…ï¼ˆéç·šå½¢ï¼‰
gain = 5.0  # å¢—å¹…ç‡
amplified_signal = gain * input_signal

# ğŸ”¹ ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°ï¼ˆã‚¢ãƒ³ãƒ—ã®æ­ªã¿åŠ¹æœï¼‰
clip_level = 1.0  # ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°é–¾å€¤ï¼ˆ-1.0 ï½ 1.0 ã«åˆ¶é™ï¼‰
clipped_signal = np.clip(amplified_signal, -clip_level, clip_level)

# ğŸ”¹ ãƒ­ãƒ¼ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã®å‘¨æ³¢æ•°å¿œç­”ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
def lowpass_filter(signal, cutoff=5000, fs=fs, order=4):
    nyq = 0.5 * fs
    normal_cutoff = cutoff / nyq
    b, a = butter(order, normal_cutoff, btype='low', analog=False)
    return filtfilt(b, a, signal)

filtered_signal = lowpass_filter(clipped_signal)

# ğŸ”¹ æ³¢å½¢ã®å¯è¦–åŒ–
plt.figure(figsize=(12, 6))

plt.subplot(3, 1, 1)
plt.plot(t, input_signal, label="Input Guitar Signal", color='b')
plt.xlabel("Time (s)")
plt.ylabel("Amplitude")
plt.title("Input Guitar Signal (Clean)")
plt.grid()
plt.legend()

plt.subplot(3, 1, 2)
plt.plot(t, clipped_signal, label="Amplified & Clipped Signal", color='r')
plt.xlabel("Time (s)")
plt.ylabel("Amplitude")
plt.title("Amplified Guitar Signal with Clipping")
plt.grid()
plt.legend()

plt.subplot(3, 1, 3)
plt.plot(t, filtered_signal, label="Final Output (Low-Pass Filtered)", color='g')
plt.xlabel("Time (s)")
plt.ylabel("Amplitude")
plt.title("Final Guitar Output (Filtered for Speaker)")
plt.grid()
plt.legend()

plt.tight_layout()
plt.show()
